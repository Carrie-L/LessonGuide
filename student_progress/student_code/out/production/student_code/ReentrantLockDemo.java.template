/**
 * Task 1.1.10: ReentrantLockä¸AQSæ¡†æ¶æ·±åº¦è§£æ
 * 
 * ä»»åŠ¡è¦æ±‚ï¼š
 * 1. æŒæ¡ReentrantLockçš„é«˜çº§ç‰¹æ€§
 * 2. ç†è§£AQS(AbstractQueuedSynchronizer)æ¡†æ¶åŸç†
 * 3. å¯¹æ¯”ReentrantLockä¸synchronizedçš„å·®å¼‚
 * 4. å­¦ä¹ å…¬å¹³é”ä¸éå…¬å¹³é”çš„å®ç°
 * 
 * âš ï¸ é‡ç‚¹ç†è§£ReentrantLockç›¸æ¯”synchronizedçš„ä¼˜åŠ¿
 */
import java.util.concurrent.locks.ReentrantLock;
import java.util.concurrent.locks.Condition;
import java.util.concurrent.TimeUnit;

public class ReentrantLockDemo {
    
    // TODO 1: å£°æ˜å…¬å¹³é”å’Œéå…¬å¹³é”
    // private static final ReentrantLock fairLock = ?;
    // private static final ReentrantLock unfairLock = ?;
    
    public static void main(String[] args) throws InterruptedException {
        System.out.println("=== ReentrantLockä¸AQSæ¡†æ¶è§£æ ===");
        
        // TODO 2: åŸºæœ¬åŠŸèƒ½æ¼”ç¤º
        demonstrateBasicFeatures();
        
        // TODO 3: é«˜çº§ç‰¹æ€§æ¼”ç¤º
        demonstrateAdvancedFeatures();
        
        // TODO 4: å…¬å¹³é”vséå…¬å¹³é”
        compareFairVsUnfairLock();
        
        // TODO 5: Conditionæ¡ä»¶å˜é‡
        demonstrateCondition();
    }
    
    /**
     * TODO: å®ç°åŸºæœ¬åŠŸèƒ½æ¼”ç¤º
     */
    private static void demonstrateBasicFeatures() throws InterruptedException {
        System.out.println("\n--- ReentrantLockåŸºæœ¬åŠŸèƒ½ ---");
        
        // ReentrantLock lock = new ReentrantLock();
        
        // TODO: æ¼”ç¤ºå¯é‡å…¥æ€§
        // demonstrateReentrant(lock);
        
        // TODO: æ¼”ç¤ºå¯ä¸­æ–­é”è·å–
        // demonstrateInterruptible(lock);
        
        // TODO: æ¼”ç¤ºtryLock
        // demonstrateTryLock(lock);
    }
    
    /**
     * TODO: å®ç°å¯é‡å…¥æ€§æ¼”ç¤º
     */
    private static void demonstrateReentrant(ReentrantLock lock) {
        System.out.println("\nğŸ”„ å¯é‡å…¥æ€§æ¼”ç¤º:");
        
        // TODO: åˆ›å»ºåµŒå¥—é”è·å–çš„æ–¹æ³•
        // class ReentrantTask {
        //     void method1() {
        //         lock.lock();
        //         try {
        //             System.out.println("Method1: æŒæœ‰è®¡æ•°=" + lock.getHoldCount());
        //             method2(); // é‡å…¥
        //         } finally {
        //             lock.unlock();
        //         }
        //     }
        //     
        //     void method2() {
        //         TODO: å†æ¬¡è·å–åŒä¸€ä¸ªé”
        //     }
        // }
    }
    
    /**
     * TODO: å®ç°å¯ä¸­æ–­é”è·å–æ¼”ç¤º
     */
    private static void demonstrateInterruptible(ReentrantLock lock) throws InterruptedException {
        System.out.println("\nâš¡ å¯ä¸­æ–­é”è·å–æ¼”ç¤º:");
        
        // TODO: ä¸»çº¿ç¨‹æŒæœ‰é”
        // lock.lock();
        
        // TODO: åˆ›å»ºå°è¯•è·å–é”çš„çº¿ç¨‹
        // Thread interruptibleThread = new Thread(() -> {
        //     try {
        //         lock.lockInterruptibly(); // å¯ä¸­æ–­çš„é”è·å–
        //         // å¤„ç†é€»è¾‘
        //     } catch (InterruptedException e) {
        //         System.out.println("è¢«ä¸­æ–­");
        //     }
        // });
        
        // TODO: å¯åŠ¨çº¿ç¨‹ï¼Œç„¶åä¸­æ–­å®ƒ
    }
    
    /**
     * TODO: å®ç°tryLockæ¼”ç¤º
     */
    private static void demonstrateTryLock(ReentrantLock lock) throws InterruptedException {
        System.out.println("\nğŸ¯ å°è¯•è·å–é”æ¼”ç¤º:");
        
        // TODO: æµ‹è¯•æ— å‚tryLock
        // boolean acquired = lock.tryLock();
        
        // TODO: æµ‹è¯•å¸¦è¶…æ—¶çš„tryLock
        // boolean success = lock.tryLock(2, TimeUnit.SECONDS);
    }
    
    /**
     * TODO: å®ç°é«˜çº§ç‰¹æ€§æ¼”ç¤º
     */
    private static void demonstrateAdvancedFeatures() {
        System.out.println("\n--- ReentrantLocké«˜çº§ç‰¹æ€§ ---");
        
        // TODO: å±•ç¤ºé”çŠ¶æ€æŸ¥è¯¢æ–¹æ³•
        // lock.isLocked()
        // lock.isHeldByCurrentThread()
        // lock.getQueueLength()
        // lock.getHoldCount()
    }
    
    /**
     * TODO: å®ç°å…¬å¹³é”vséå…¬å¹³é”å¯¹æ¯”
     */
    private static void compareFairVsUnfairLock() throws InterruptedException {
        System.out.println("\n--- å…¬å¹³é” vs éå…¬å¹³é” ---");
        
        // TODO: æµ‹è¯•éå…¬å¹³é”çš„è·å–é¡ºåº
        
        // TODO: æµ‹è¯•å…¬å¹³é”çš„è·å–é¡ºåº
        
        // TODO: å¯¹æ¯”ä¸¤ç§é”çš„è¡Œä¸ºå·®å¼‚
    }
    
    /**
     * TODO: å®ç°Conditionæ¡ä»¶å˜é‡æ¼”ç¤º
     */
    private static void demonstrateCondition() throws InterruptedException {
        System.out.println("\n--- Conditionæ¡ä»¶å˜é‡æ¼”ç¤º ---");
        
        // TODO: å®ç°æœ‰ç•Œç¼“å†²åŒº
        // BoundedBuffer<String> buffer = new BoundedBuffer<>(3);
        
        // TODO: åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹
        // ä½¿ç”¨ buffer.put() æ–¹æ³•
        
        // TODO: åˆ›å»ºæ¶ˆè´¹è€…çº¿ç¨‹
        // ä½¿ç”¨ buffer.take() æ–¹æ³•
    }
    
    /**
     * TODO: å®ç°æœ‰ç•Œç¼“å†²åŒºç±»
     */
    static class BoundedBuffer<T> {
        // private final T[] buffer;
        // private final ReentrantLock lock = new ReentrantLock();
        // private final Condition notEmpty = lock.newCondition();
        // private final Condition notFull = lock.newCondition();
        
        // public void put(T item) throws InterruptedException {
        //     lock.lock();
        //     try {
        //         while (count == buffer.length) {
        //             notFull.await(); // ç­‰å¾…ä¸æ»¡æ¡ä»¶
        //         }
        //         TODO: æ·»åŠ å…ƒç´ å¹¶é€šçŸ¥æ¶ˆè´¹è€…
        //     } finally {
        //         lock.unlock();
        //     }
        // }
        
        // public T take() throws InterruptedException {
        //     TODO: å®ç°takeæ–¹æ³•
        // }
    }
}